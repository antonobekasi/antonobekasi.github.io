<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Auto Content Generator (ACG) green v7.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #0A0A0A;
            color: #D4D4D4;
        }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .neon-lime { color: #a3e635; }
        .bg-neon-lime { background-color: #a3e635; }
        .border-neon-lime { border-color: #a3e635; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .step-hidden { display: none; }
        
        .loading-overlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            align-items: center;
            justify-content: center;
            text-align: center;
        }
    </style>
</head>
<body class="selection:bg-[#a3e635] selection:text-black">

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay flex-col">
        <div class="relative mb-8">
            <div class="absolute inset-0 bg-[#a3e635]/20 blur-3xl rounded-full animate-pulse"></div>
            <i class="fas fa-circle-notch fa-spin text-5xl neon-lime relative z-10"></i>
        </div>
        <h2 class="text-2xl font-black text-white uppercase italic tracking-tighter mb-2">Mengolah Data...</h2>
        <p id="loadingMsg" class="neon-lime font-mono text-[10px] uppercase tracking-[0.4em]">Menghubungi Tim AI Spesialis</p>
    </div>

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-[#0A0A0A] border-b border-neutral-800 px-6 py-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <div class="bg-neon-lime p-2 rounded-lg">
                <i class="fas fa-microchip text-black text-sm"></i>
            </div>
            <span class="font-black tracking-tighter text-white uppercase italic">ACG <span class="neon-lime">green v7.1</span></span>
        </div>
        <div id="navSteps" class="flex gap-2 overflow-x-auto no-scrollbar">
            <!-- Steps Generated by JS -->
        </div>
    </nav>

    <main class="max-w-6xl mx-auto p-6 md:p-12">
        
        <!-- Step 1: Konfigurasi -->
        <section id="step1" class="step-content max-w-2xl mx-auto space-y-10">
            <header class="text-center space-y-2">
                <h1 class="text-4xl font-black text-white uppercase italic tracking-tighter">Mulai <span class="neon-lime">Produksi</span></h1>
                <p class="text-neutral-500 font-mono text-sm">Definisikan konteks untuk tim AI spesialis Anda.</p>
            </header>
            
            <div class="bg-neutral-900 border border-neutral-800 p-8 rounded-[2rem] space-y-6 shadow-2xl relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-10 text-[#a3e635]/5 group-hover:text-[#a3e635]/10 transition-colors pointer-events-none">
                    <i class="fas fa-wand-magic-sparkles text-[120px]"></i>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label class="text-[10px] font-bold text-neutral-500 uppercase tracking-widest">Niche</label>
                        <select id="niche" class="w-full bg-black border border-neutral-800 p-4 rounded-xl outline-none focus:border-[#a3e635] text-sm">
                            <option>Film & Animation</option>
                            <option>Gaming</option>
                            <option>People & Blogs</option>
                            <option>Education</option>
                            <option>Science & Technology</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-bold text-neutral-500 uppercase tracking-widest">Tone</label>
                        <select id="tone" class="w-full bg-black border border-neutral-800 p-4 rounded-xl outline-none focus:border-[#a3e635] text-sm">
                            <option>Storytelling</option>
                            <option>Mind-Blowing</option>
                            <option>Sarkastik</option>
                            <option>News-Style</option>
                        </select>
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-neutral-500 uppercase tracking-widest">Topik Utama</label>
                    <textarea id="topic" class="w-full h-32 bg-black border border-neutral-800 p-5 rounded-2xl outline-none focus:border-[#a3e635] text-lg font-bold resize-none" placeholder="Contoh: Perjalanan solo motor ke Bali..."></textarea>
                </div>

                <div class="space-y-2">
                    <label class="text-[10px] font-bold text-neutral-500 uppercase tracking-widest">Target Audiens</label>
                    <input id="audience" class="w-full bg-black border border-neutral-800 p-4 rounded-xl outline-none focus:border-[#a3e635]" placeholder="Misal: Gen Z, Penggemar Otomotif">
                </div>

                <button onclick="handleStep1()" class="w-full py-5 bg-neon-lime text-black font-black uppercase tracking-widest rounded-2xl hover:brightness-110 transition-all flex items-center justify-center gap-3 shadow-lg shadow-[#a3e635]/10">
                    <i class="fas fa-wand-sparkles"></i> Brainstorm Ide Viral
                </button>
            </div>
        </section>

        <!-- Step 2: Judul -->
        <section id="step2" class="step-content step-hidden max-w-4xl mx-auto space-y-8">
            <header class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-black text-white uppercase italic tracking-tighter">Judul <span class="neon-lime">Viral</span></h2>
                    <p class="text-xs text-neutral-500 font-mono">Diproses oleh Headline Specialist</p>
                </div>
                <button onclick="goToStep(1)" class="p-3 bg-neutral-900 rounded-full hover:text-white"><i class="fas fa-chevron-left"></i></button>
            </header>
            <div id="titlesList" class="grid gap-4"></div>
        </section>

        <!-- Step 3: Hook -->
        <section id="step3" class="step-content step-hidden max-w-4xl mx-auto space-y-8">
            <header class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-black text-white uppercase italic tracking-tighter">Hook <span class="neon-lime">3-Detik</span></h2>
                    <p class="text-xs text-neutral-500 font-mono">Diproses oleh Attention Engineer</p>
                </div>
                <button onclick="goToStep(2)" class="p-3 bg-neutral-900 rounded-full hover:text-white"><i class="fas fa-chevron-left"></i></button>
            </header>
            <div id="hooksList" class="grid md:grid-cols-3 gap-4"></div>
        </section>

        <!-- Step 4: Arsitektur -->
        <section id="step4" class="step-content step-hidden max-w-5xl mx-auto space-y-8">
            <header class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-black text-white uppercase italic tracking-tighter">Arsitektur <span class="neon-lime">Konten</span></h2>
                    <p class="text-xs text-neutral-500 font-mono">Diproses oleh Content Architect</p>
                </div>
                <button onclick="goToStep(3)" class="p-3 bg-neutral-900 rounded-full hover:text-white"><i class="fas fa-chevron-left"></i></button>
            </header>
            <div class="grid lg:grid-cols-3 gap-6">
                <div class="bg-neutral-900 p-6 rounded-2xl border border-neutral-800 space-y-4">
                    <label class="text-[10px] font-black uppercase tracking-widest text-neutral-500">Format</label>
                    <div id="formatButtons" class="space-y-2">
                        <!-- Generated by JS -->
                    </div>
                </div>
                <div class="lg:col-span-2 space-y-4">
                    <textarea id="outlineArea" class="w-full h-[400px] bg-neutral-900 border border-neutral-800 p-8 rounded-3xl outline-none font-mono text-xs leading-relaxed text-neutral-400 focus:border-[#a3e635]"></textarea>
                    <button onclick="handleStep4()" class="w-full py-5 bg-neon-lime text-black font-black uppercase tracking-widest rounded-2xl transition-all">Tulis Naskah Detail</button>
                </div>
            </div>
        </section>

        <!-- Step 5: Naskah -->
        <section id="step5" class="step-content step-hidden max-w-6xl mx-auto space-y-8">
            <header class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-black text-white uppercase italic tracking-tighter">Naskah <span class="neon-lime">Storyboard</span></h2>
                    <p class="text-xs text-neutral-500 font-mono">Diproses oleh Storyteller & Copywriter</p>
                </div>
                <button onclick="goToStep(4)" class="p-3 bg-neutral-900 rounded-full hover:text-white"><i class="fas fa-chevron-left"></i></button>
            </header>
            <div class="bg-neutral-900 rounded-[2rem] border border-neutral-800 overflow-hidden shadow-2xl">
                <div class="bg-black/40 px-6 py-3 border-b border-neutral-800 flex justify-between items-center">
                    <span class="text-[10px] font-mono text-neutral-600 uppercase">FINAL_SCRIPT_GEN.txt</span>
                    <button onclick="copyToClipboard('scriptArea')" class="text-[10px] font-bold text-neutral-500 hover:text-[#a3e635] flex items-center gap-2"><i class="fas fa-copy"></i> Copy</button>
                </div>
                <textarea id="scriptArea" class="w-full h-[550px] bg-transparent p-10 outline-none font-mono text-xs leading-8 text-neutral-400 resize-none"></textarea>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="handleStep4()" class="py-5 bg-neutral-800 font-bold uppercase tracking-widest rounded-2xl hover:bg-neutral-700 transition-all">Regenerate</button>
                <button onclick="handleStep5(true)" class="py-5 bg-neon-lime text-black font-black uppercase tracking-widest rounded-2xl transition-all shadow-xl shadow-[#a3e635]/10 flex items-center justify-center gap-2"><i class="fas fa-image"></i> Visual Concept</button>
            </div>
        </section>

        <!-- Step 6: Visual -->
        <section id="step6" class="step-content step-hidden max-w-6xl mx-auto space-y-8">
            <header class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-black text-white uppercase italic tracking-tighter">Psikologi <span class="neon-lime">Visual</span></h2>
                    <p class="text-xs text-neutral-500 font-mono">Diproses oleh Visual Psychologist</p>
                </div>
                <button onclick="goToStep(5)" class="p-3 bg-neutral-900 rounded-full hover:text-white"><i class="fas fa-chevron-left"></i></button>
            </header>
            <div class="grid lg:grid-cols-2 gap-10">
                <div class="space-y-6">
                    <div id="visualContainer" class="relative bg-neutral-900 rounded-3xl overflow-hidden shadow-2xl border border-neutral-800 flex items-center justify-center min-h-[300px]">
                        <!-- Image Rendered Here -->
                    </div>
                    <div class="bg-neutral-900/50 p-6 rounded-2xl border border-neutral-800">
                        <h4 class="text-[10px] font-black neon-lime uppercase mb-2 tracking-widest">Strategy Reasoning</h4>
                        <p id="designReasoning" class="text-[11px] font-mono text-neutral-400 italic">"Menganalisis pola visual terbaik..."</p>
                    </div>
                </div>
                <div class="bg-neutral-900 p-8 rounded-3xl space-y-6 border border-neutral-800/50">
                    <div class="space-y-4">
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold text-neutral-500 uppercase">Headline Teks (In-Painting)</label>
                            <input id="mainVisualText" class="w-full bg-black border border-neutral-800 p-4 rounded-xl neon-lime font-black outline-none focus:border-[#a3e635]">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold text-neutral-500 uppercase">AI Visual Prompt</label>
                            <textarea id="visualPrompt" class="w-full h-32 bg-black border border-neutral-800 p-4 rounded-xl text-[10px] font-mono text-neutral-500 outline-none focus:border-[#a3e635] resize-none"></textarea>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="handleStep5(true)" class="py-4 bg-neutral-800 rounded-xl font-bold text-[10px] uppercase transition-all">Konsep Baru</button>
                        <button onclick="handleStep5(false)" class="py-4 bg-[#a3e635]/10 border border-[#a3e635]/20 neon-lime rounded-xl font-black text-[10px] uppercase transition-all">Render Ulang</button>
                    </div>
                    <button onclick="handleStep6()" class="w-full py-5 bg-neon-lime text-black font-black uppercase tracking-widest rounded-2xl transition-all shadow-xl shadow-[#a3e635]/10">Finalisasi Distribusi</button>
                </div>
            </div>
        </section>

        <!-- Step 7: Distribusi -->
        <section id="step7" class="step-content step-hidden max-w-6xl mx-auto space-y-8">
            <header class="flex items-center justify-between">
                <div>
                    <h2 class="text-2xl font-black text-white uppercase italic tracking-tighter">Distribusi <span class="neon-lime">Cerdas</span></h2>
                    <p class="text-xs text-neutral-500 font-mono">Diproses oleh Conversation Starter</p>
                </div>
                <button onclick="goToStep(6)" class="p-3 bg-neutral-900 rounded-full hover:text-white"><i class="fas fa-chevron-left"></i></button>
            </header>
            <div id="distributionList" class="grid md:grid-cols-3 gap-6"></div>
            <button onclick="copyFullProject()" class="w-full py-8 bg-neon-lime text-black font-black text-2xl uppercase italic tracking-tighter rounded-[3rem] hover:scale-[1.01] transition-all shadow-2xl shadow-[#a3e635]/20 flex items-center justify-center gap-4">
                <i class="fas fa-check-circle"></i> Copy All Project Data
            </button>
        </section>

    </main>

    <!-- Background Decor -->
    <div class="fixed inset-0 pointer-events-none -z-10 overflow-hidden">
        <div class="absolute top-1/4 left-1/4 w-[500px] h-[500px] bg-[#a3e635]/5 blur-[120px] rounded-full"></div>
        <div class="absolute bottom-1/4 right-1/4 w-[500px] h-[500px] bg-blue-500/5 blur-[120px] rounded-full"></div>
    </div>

    <script>
        const API_KEY = ""; // Environment handles this
        let currentStep = 1;
        
        let project = {
            niche: "Entertainment",
            topic: "",
            audience: "",
            tone: "Storytelling",
            titles: [],
            selectedTitle: "",
            hooks: [],
            selectedHook: "",
            format: "YouTube Long Video",
            outline: "",
            script: "",
            thumbnail: { image: null, mainText: "", subText: "", visualPrompt: "", designReasoning: "" },
            distribution: { instagram: "", tiktok: "", youtube: "" }
        };

        const navIcons = ['sparkles', 'type', 'anchor', 'list', 'clapperboard', 'image', 'hashtag'];

        // --- Core Functions ---

        function initNav() {
            const nav = document.getElementById('navSteps');
            nav.innerHTML = navIcons.map((icon, i) => `
                <button onclick="goToStep(${i + 1})" class="nav-btn flex items-center gap-2 px-3 py-1.5 rounded-full text-[10px] font-bold uppercase transition-all ${currentStep === i + 1 ? 'bg-neon-lime text-black' : 'text-neutral-700 opacity-50'}" id="nav-step-${i+1}">
                    <i class="fas fa-${icon}"></i> Step ${i + 1}
                </button>
            `).join('');
            
            const formats = ["YouTube Long Video", "TikTok / Reels", "Carousel", "Thread"];
            document.getElementById('formatButtons').innerHTML = formats.map(f => `
                <button onclick="setFormat('${f}')" class="format-btn w-full p-4 rounded-xl text-[10px] font-bold uppercase text-left transition-all ${project.format === f ? 'bg-neon-lime text-black' : 'bg-black text-neutral-500'}" data-format="${f}">
                    ${f}
                </button>
            `).join('');
        }

        function setFormat(f) {
            project.format = f;
            document.querySelectorAll('.format-btn').forEach(btn => {
                if(btn.dataset.format === f) {
                    btn.classList.add('bg-neon-lime', 'text-black');
                    btn.classList.remove('bg-black', 'text-neutral-500');
                } else {
                    btn.classList.remove('bg-neon-lime', 'text-black');
                    btn.classList.add('bg-black', 'text-neutral-500');
                }
            });
        }

        function goToStep(s) {
            if (s > currentStep && !project.topic) return;
            
            document.querySelectorAll('.step-content').forEach(el => el.classList.add('step-hidden'));
            document.getElementById(`step${s}`).classList.remove('step-hidden');
            
            currentStep = s;
            document.querySelectorAll('.nav-btn').forEach((btn, i) => {
                if (i + 1 === s) {
                    btn.classList.add('bg-neon-lime', 'text-black');
                    btn.classList.remove('text-neutral-700', 'opacity-50');
                } else if (i + 1 < s) {
                    btn.classList.add('text-neutral-400');
                    btn.classList.remove('bg-neon-lime', 'text-black', 'text-neutral-700', 'opacity-50');
                } else {
                    btn.classList.add('text-neutral-700', 'opacity-50');
                    btn.classList.remove('bg-neon-lime', 'text-black', 'text-neutral-400');
                }
            });
        }

        async function callAI(prompt, systemPrompt, isJson = true) {
            let retries = 0;
            const maxRetries = 5;
            
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: isJson ? { responseMimeType: "application/json" } : {}
            };

            while (retries < maxRetries) {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    const data = await response.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (!text) throw new Error("API Fail");
                    return isJson ? JSON.parse(text) : text;
                } catch (err) {
                    retries++;
                    if (retries === maxRetries) throw err;
                    await new Promise(r => setTimeout(r, Math.pow(2, retries) * 1000));
                }
            }
        }

        async function generateVisual(prompt, ratio) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        instances: [{ prompt }],
                        parameters: { sampleCount: 1, aspectRatio: ratio }
                    })
                });
                const data = await response.json();
                return `data:image/png;base64,${data.predictions[0].bytesBase64Encoded}`;
            } catch (err) {
                return null;
            }
        }

        function toggleLoading(show, msg = "") {
            const overlay = document.getElementById('loadingOverlay');
            document.getElementById('loadingMsg').innerText = msg;
            overlay.style.display = show ? 'flex' : 'none';
        }

        function copyToClipboard(id) {
            const el = document.getElementById(id);
            el.select();
            document.execCommand('copy');
        }

        // --- Step Logic ---

        async function handleStep1() {
            project.topic = document.getElementById('topic').value;
            project.niche = document.getElementById('niche').value;
            project.tone = document.getElementById('tone').value;
            project.audience = document.getElementById('audience').value;

            if(!project.topic) return;

            toggleLoading(true, "Menghubungi: Headline Specialist...");
            try {
                const system = `BERTINDAK SEBAGAI: Headline Specialist. TUGAS: Racik 5 judul viral organik. OUTPUT: JSON { titles: [{ text, score, reasoning }] }. Gunakan Bahasa Indonesia.`;
                const prompt = `Topik: ${project.topic}. Target: ${project.audience}. Niche: ${project.niche}. Tone: ${project.tone}.`;
                
                const res = await callAI(prompt, system);
                project.titles = res.titles;
                
                const list = document.getElementById('titlesList');
                list.innerHTML = res.titles.map((t, i) => `
                    <button onclick="handleStep2('${t.text.replace(/'/g, "\\'")}')" class="group bg-neutral-900 border border-neutral-800 p-6 rounded-2xl flex items-center justify-between hover:border-[#a3e635] transition-all">
                        <div class="text-left space-y-2">
                            <div class="flex gap-2 items-center">
                                <span class="px-2 py-0.5 rounded text-[8px] font-bold uppercase ${t.score > 85 ? 'bg-[#a3e635] text-black' : 'bg-yellow-400 text-black'}">Score: ${t.score}%</span>
                                <span class="text-[10px] font-mono text-neutral-600 italic">"${t.reasoning}"</span>
                            </div>
                            <h3 class="text-xl font-bold text-white group-hover:neon-lime transition-colors">${t.text}</h3>
                        </div>
                        <i class="fas fa-chevron-right text-neutral-700 group-hover:neon-lime"></i>
                    </button>
                `).join('');
                
                goToStep(2);
            } catch (e) { console.error(e); }
            finally { toggleLoading(false); }
        }

        async function handleStep2(title) {
            project.selectedTitle = title;
            toggleLoading(true, "Menghubungi: Attention Engineer...");
            try {
                const system = `BERTINDAK SEBAGAI: Attention Engineer. TUGAS: Buat 3 hook pembuka 3-detik. OUTPUT: JSON { hooks: [{ text, type }] }.`;
                const res = await callAI(`Judul: ${title}`, system);
                project.hooks = res.hooks;
                
                document.getElementById('hooksList').innerHTML = res.hooks.map(h => `
                    <button onclick="handleStep3('${h.text.replace(/'/g, "\\'")}')" class="p-6 bg-neutral-900 border border-neutral-800 rounded-2xl text-left hover:border-[#a3e635] transition-all flex flex-col justify-between">
                        <p class="text-sm font-bold text-white mb-6 leading-relaxed">"${h.text}"</p>
                        <span class="text-[8px] font-black uppercase tracking-widest text-neutral-600 px-2 py-1 bg-black rounded-lg w-fit">${h.type}</span>
                    </button>
                `).join('');
                
                goToStep(3);
            } catch (e) { console.error(e); }
            finally { toggleLoading(false); }
        }

        async function handleStep3(hook) {
            project.selectedHook = hook;
            toggleLoading(true, "Menghubungi: Content Architect...");
            try {
                const system = `BERTINDAK SEBAGAI: Content Architect. TUGAS: Susun kerangka logis. OUTPUT: JSON { outline: string }.`;
                const res = await callAI(`Judul: ${project.selectedTitle}. Hook: ${hook}`, system);
                project.outline = res.outline;
                document.getElementById('outlineArea').value = res.outline;
                goToStep(4);
            } catch (e) { console.error(e); }
            finally { toggleLoading(false); }
        }

        async function handleStep4() {
            project.outline = document.getElementById('outlineArea').value;
            toggleLoading(true, "Menghubungi: Master Storyteller...");
            try {
                const system = `BERTINDAK SEBAGAI: Master Storyteller. TUGAS: Tulis naskah detail. Format: [SCENE XX] -- ‚è≥ TIME -- üé• VISUAL -- üéôÔ∏è AUDIO.`;
                const res = await callAI(`Outline: ${project.outline}. Format: ${project.format}`, system, false);
                project.script = res;
                document.getElementById('scriptArea').value = res;
                goToStep(5);
            } catch (e) { console.error(e); }
            finally { toggleLoading(false); }
        }

        async function handleStep5(isNew = true) {
            project.script = document.getElementById('scriptArea').value;
            toggleLoading(true, "Menghubungi: Visual Psychologist...");
            try {
                if (isNew) {
                    const system = `BERTINDAK SEBAGAI: Visual Psychologist. TUGAS: Rancang konsep thumbnail in-painting. OUTPUT: JSON { mainText, subText, visualPrompt, designReasoning }.`;
                    const res = await callAI(`Judul: ${project.selectedTitle}. Naskah: ${project.script.slice(0, 300)}`, system);
                    project.thumbnail = { ...project.thumbnail, ...res };
                    document.getElementById('mainVisualText').value = res.mainText;
                    document.getElementById('visualPrompt').value = res.visualPrompt;
                    document.getElementById('designReasoning').innerText = res.designReasoning;
                } else {
                    project.thumbnail.mainText = document.getElementById('mainVisualText').value;
                    project.thumbnail.visualPrompt = document.getElementById('visualPrompt').value;
                }

                const ratio = project.format.includes("TikTok") ? "9:16" : "16:9";
                const container = document.getElementById('visualContainer');
                container.innerHTML = '<div class="text-[10px] font-mono animate-pulse uppercase tracking-[0.3em] neon-lime"><i class="fas fa-circle-notch fa-spin mr-2"></i> Rendering Pixels...</div>';
                
                const prompt = `${project.thumbnail.visualPrompt}, text "${project.thumbnail.mainText}" as cinematic title, 8k`;
                const img = await generateVisual(prompt, ratio);
                
                project.thumbnail.image = img;
                container.className = `relative bg-neutral-900 rounded-3xl overflow-hidden shadow-2xl border border-neutral-800 flex items-center justify-center ${project.format.includes("TikTok") ? 'aspect-[9/16] max-w-[300px] mx-auto' : 'aspect-video w-full'}`;
                container.innerHTML = img ? `<img src="${img}" class="w-full h-full object-cover">` : `<p class="text-red-500 font-bold">Gagal Me-render Gambar</p>`;
                
                goToStep(6);
            } catch (e) { console.error(e); }
            finally { toggleLoading(false); }
        }

        async function handleStep6() {
            toggleLoading(true, "Menghubungi: Conversation Starter...");
            try {
                const system = `BERTINDAK SEBAGAI: Conversation Starter. TUGAS: Buat caption interaktif. OUTPUT: JSON { instagram, tiktok, youtube }.`;
                const res = await callAI(`Naskah: ${project.script.slice(0, 300)}`, system);
                project.distribution = res;
                
                const list = document.getElementById('distributionList');
                const platforms = [
                    { id: 'instagram', label: 'Instagram', text: res.instagram, icon: 'instagram' },
                    { id: 'tiktok', label: 'TikTok', text: res.tiktok, icon: 'tiktok' },
                    { id: 'youtube', label: 'YouTube', text: res.youtube, icon: 'youtube' }
                ];
                
                list.innerHTML = platforms.map(p => `
                    <div class="bg-neutral-900 border border-neutral-800 rounded-3xl p-6 flex flex-col group relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-10 opacity-5 group-hover:neon-lime transition-all"><i class="fas fa-hashtag text-[80px]"></i></div>
                        <div class="flex items-center gap-2 mb-4 relative">
                            <div class="w-6 h-6 rounded bg-neon-lime flex items-center justify-center"><i class="fas fa-bolt text-black text-[10px]"></i></div>
                            <span class="text-[10px] font-black uppercase tracking-widest text-white">${p.label}</span>
                        </div>
                        <div id="cap-${p.id}" class="flex-1 bg-black rounded-2xl p-4 font-mono text-[10px] text-neutral-400 mb-6 max-h-[250px] overflow-y-auto border border-neutral-800">
                            ${p.text}
                        </div>
                        <button onclick="copyRawText('${p.id}')" class="w-full py-3 bg-neutral-800 hover:bg-neutral-700 rounded-xl font-bold text-[10px] uppercase flex items-center justify-center gap-2 transition-all">
                            <i class="fas fa-copy"></i> Copy Caption
                        </button>
                    </div>
                `).join('');
                
                goToStep(7);
            } catch (e) { console.error(e); }
            finally { toggleLoading(false); }
        }

        function copyRawText(id) {
            const text = project.distribution[id];
            const temp = document.createElement('textarea');
            temp.value = text;
            document.body.appendChild(temp);
            temp.select();
            document.execCommand('copy');
            document.body.removeChild(temp);
        }

        function copyFullProject() {
            const temp = document.createElement('textarea');
            temp.value = JSON.stringify(project, null, 2);
            document.body.appendChild(temp);
            temp.select();
            document.execCommand('copy');
            document.body.removeChild(temp);
        }

        window.onload = initNav;
    </script>
</body>
</html>
