<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NYETAK Auto Content Generator (ACG)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap');
        
        :root {
            --neon-lime: #a3e635;
            --bg-dark: #050505;
            --card-bg: rgba(23, 23, 23, 0.7);
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-dark);
            color: #f4f4f5;
            overflow-x: hidden;
        }

        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* Glassmorphism */
        .glass {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .glass-hover:hover {
            border-color: rgba(163, 230, 53, 0.3);
            background: rgba(23, 23, 23, 0.9);
        }

        /* Loading Animation */
        .loader-ring {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            position: relative;
            border: 4px solid transparent;
            border-top-color: var(--neon-lime);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .step-content {
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }

        /* Custom Input */
        input, select, textarea {
            transition: all 0.2s ease;
        }
        input:focus, select:focus, textarea:focus {
            box-shadow: 0 0 0 2px rgba(163, 230, 53, 0.2);
        }

        .gradient-text {
            background: linear-gradient(to right, #ffffff, #a3e635);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body class="selection:bg-[#a3e635] selection:text-black">

    <!-- Global Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 z-[100] bg-black/90 backdrop-blur-xl hidden flex-col items-center justify-center text-center">
        <div class="loader-ring mb-6"></div>
        <div class="space-y-2">
            <h2 class="text-2xl font-extrabold uppercase tracking-tighter italic" id="loadingTitle">Processing</h2>
            <p id="loadingMsg" class="text-[#a3e635] font-mono text-xs uppercase tracking-[0.3em]">Menyinkronkan data dengan AI...</p>
        </div>
    </div>

    <!-- Header Navigation -->
    <nav class="sticky top-0 z-50 glass border-b border-white/5 px-6 py-4">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="bg-[#a3e635] w-10 h-10 rounded-xl flex items-center justify-center shadow-lg shadow-[#a3e635]/20">
                    <i class="fas fa-bolt text-black"></i>
                </div>
                <h1 class="font-extrabold text-xl tracking-tighter uppercase italic">NYETAK <span class="text-[#a3e635]">ACG</span></h1>
            </div>

            <!-- Stepper Progress -->
            <div id="navSteps" class="hidden md:flex items-center gap-1 bg-black/40 p-1.5 rounded-2xl border border-white/5">
                <!-- Steps generated by JS -->
            </div>

            <div class="text-[10px] font-mono text-neutral-500 hidden sm:block">
                v2.0 • AI-DRIVEN
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-6 py-12">
        
        <!-- STEP 1: BRAINSTORMING -->
        <section id="step1" class="step-content max-w-3xl mx-auto">
            <div class="text-center mb-12">
                <span class="text-[#a3e635] font-mono text-[10px] uppercase tracking-[0.4em] mb-4 block">Engine Initialization</span>
                <h2 class="text-5xl font-extrabold gradient-text italic tracking-tighter mb-4">APA YANG AKAN KITA <span class="text-[#a3e635]">CETAK?</span></h2>
                <p class="text-neutral-400 text-lg">Mulai transformasi ide kasar menjadi konten viral dalam hitungan detik.</p>
            </div>

            <div class="glass p-8 md:p-12 rounded-[2.5rem] space-y-8">
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-3">
                        <label class="text-xs font-bold uppercase tracking-widest text-neutral-500 ml-1">Kategori Niche</label>
                        <select id="niche" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl outline-none focus:border-[#a3e635] text-sm appearance-none">
                            <option value="Film">Film & Animasi</option>
                            <option value="Gaming">Gaming & E-Sports</option>
                            <option value="Edu">Edukasi & Tips</option>
                            <option value="Tech">Sains & Teknologi</option>
                            <option value="Life">Gaya Hidup & Vlog</option>
                        </select>
                    </div>
                    <div class="space-y-3">
                        <label class="text-xs font-bold uppercase tracking-widest text-neutral-500 ml-1">Nuansa Konten</label>
                        <select id="tone" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl outline-none focus:border-[#a3e635] text-sm appearance-none">
                            <option value="Story">Storytelling (Bercerita)</option>
                            <option value="Hype">Hype & High-Energy</option>
                            <option value="Deep">Deep & Filosofis</option>
                            <option value="Funny">Kocak & Sarkas</option>
                        </select>
                    </div>
                </div>

                <div class="space-y-3">
                    <label class="text-xs font-bold uppercase tracking-widest text-neutral-500 ml-1">Topik Utama</label>
                    <textarea id="topic" class="w-full h-40 bg-white/5 border border-white/10 p-6 rounded-3xl outline-none focus:border-[#a3e635] text-xl font-semibold resize-none placeholder:text-neutral-700" placeholder="Contoh: Manfaat kopi di pagi hari tapi dari sudut pandang kesehatan mental..."></textarea>
                </div>

                <button onclick="handleStep1()" class="w-full group py-6 bg-[#a3e635] text-black font-extrabold uppercase tracking-widest rounded-3xl hover:scale-[1.02] transition-all flex items-center justify-center gap-4 shadow-2xl shadow-[#a3e635]/20">
                    <i class="fas fa-wand-magic-sparkles"></i> Brainstorm Ide Viral
                </button>
            </div>
        </section>

        <!-- STEP 2: TITLES -->
        <section id="step2" class="step-content hidden max-w-5xl mx-auto">
            <div class="flex items-end justify-between mb-10">
                <div class="space-y-1">
                    <p class="text-[#a3e635] font-mono text-[10px] uppercase tracking-widest">Phase 02</p>
                    <h2 class="text-4xl font-extrabold italic tracking-tighter">PILIH <span class="text-[#a3e635]">JUDUL</span></h2>
                </div>
                <button onclick="goToStep(1)" class="px-5 py-2 rounded-full glass text-xs font-bold hover:text-[#a3e635]"><i class="fas fa-arrow-left mr-2"></i> Kembali</button>
            </div>
            
            <div id="titlesList" class="grid gap-4">
                <!-- Titles dynamically injected -->
            </div>
        </section>

        <!-- STEP 3: HOOKS -->
        <section id="step3" class="step-content hidden max-w-5xl mx-auto">
            <div class="flex items-end justify-between mb-10">
                <div class="space-y-1">
                    <p class="text-[#a3e635] font-mono text-[10px] uppercase tracking-widest">Phase 03</p>
                    <h2 class="text-4xl font-extrabold italic tracking-tighter">HOOK <span class="text-[#a3e635]">PEMBUKA</span></h2>
                </div>
                <button onclick="goToStep(2)" class="px-5 py-2 rounded-full glass text-xs font-bold hover:text-[#a3e635]"><i class="fas fa-arrow-left mr-2"></i> Kembali</button>
            </div>
            <div id="hooksList" class="grid md:grid-cols-3 gap-6">
                <!-- Hooks dynamically injected -->
            </div>
        </section>

        <!-- STEP 4: OUTLINE -->
        <section id="step4" class="step-content hidden max-w-6xl mx-auto">
            <div class="grid lg:grid-cols-12 gap-10">
                <div class="lg:col-span-4 space-y-6">
                    <div class="space-y-1">
                        <p class="text-[#a3e635] font-mono text-[10px] uppercase tracking-widest">Phase 04</p>
                        <h2 class="text-4xl font-extrabold italic tracking-tighter uppercase">STRUKTUR</h2>
                    </div>
                    <div class="glass p-6 rounded-3xl space-y-6">
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold uppercase text-neutral-500">Target Format</label>
                            <div id="formatButtons" class="space-y-2"></div>
                        </div>
                        <button onclick="handleStep4()" class="w-full py-4 bg-[#a3e635] text-black font-extrabold uppercase text-xs tracking-widest rounded-2xl shadow-lg shadow-[#a3e635]/10">Generate Naskah</button>
                    </div>
                </div>
                <div class="lg:col-span-8">
                    <textarea id="outlineArea" class="w-full h-[500px] glass p-10 rounded-[2.5rem] outline-none font-mono text-sm leading-relaxed text-neutral-300 focus:border-[#a3e635] resize-none"></textarea>
                </div>
            </div>
        </section>

        <!-- STEP 5: SCRIPT -->
        <section id="step5" class="step-content hidden max-w-6xl mx-auto">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-4xl font-extrabold italic tracking-tighter">NASKAH <span class="text-[#a3e635]">STORYBOARD</span></h2>
                <div class="flex gap-2">
                    <button onclick="copyToClipboard('scriptArea')" class="px-5 py-2 glass rounded-full text-xs font-bold flex items-center gap-2 hover:text-[#a3e635]"><i class="fas fa-copy"></i> Copy</button>
                    <button onclick="goToStep(4)" class="px-5 py-2 glass rounded-full text-xs font-bold hover:text-[#a3e635]"><i class="fas fa-arrow-left"></i></button>
                </div>
            </div>
            <div class="glass rounded-[2.5rem] overflow-hidden mb-8">
                <textarea id="scriptArea" class="w-full h-[600px] bg-transparent p-12 outline-none font-mono text-sm leading-8 text-neutral-400 resize-none" spellcheck="false"></textarea>
            </div>
            <button onclick="handleStep5(true)" class="w-full py-6 bg-[#a3e635] text-black font-extrabold uppercase tracking-widest rounded-3xl transition-all shadow-2xl shadow-[#a3e635]/20 flex items-center justify-center gap-4">
                <i class="fas fa-palette"></i> Buat Konsep Visual Thumbnail
            </button>
        </section>

        <!-- STEP 6: VISUAL -->
        <section id="step6" class="step-content hidden max-w-7xl mx-auto">
            <div class="grid lg:grid-cols-2 gap-12 items-start">
                <div class="space-y-6">
                    <div id="visualContainer" class="glass rounded-[3rem] overflow-hidden min-h-[400px] flex items-center justify-center border-2 border-dashed border-white/10 group">
                        <p class="text-neutral-600 font-mono text-xs uppercase group-hover:text-[#a3e635] transition-colors">Visual AI will appear here</p>
                    </div>
                    <div class="glass p-8 rounded-[2.5rem]">
                        <h4 class="text-xs font-extrabold text-[#a3e635] uppercase tracking-widest mb-4">Analisis Visual</h4>
                        <p id="designReasoning" class="text-sm font-mono text-neutral-500 italic leading-relaxed"></p>
                    </div>
                </div>
                <div class="space-y-8 glass p-10 rounded-[3rem]">
                    <h2 class="text-3xl font-extrabold tracking-tighter italic">PENGATURAN <span class="text-[#a3e635]">VISUAL</span></h2>
                    <div class="space-y-6">
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold text-neutral-500 uppercase tracking-widest">Main Text Over Image</label>
                            <input id="mainVisualText" class="w-full bg-white/5 border border-white/10 p-5 rounded-2xl outline-none focus:border-[#a3e635] text-lg font-bold">
                        </div>
                        <div class="space-y-2">
                            <label class="text-[10px] font-bold text-neutral-500 uppercase tracking-widest">Image Prompt Detail</label>
                            <textarea id="visualPrompt" class="w-full h-32 bg-white/5 border border-white/10 p-5 rounded-2xl outline-none focus:border-[#a3e635] text-xs font-mono text-neutral-400 resize-none"></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <button onclick="handleStep5(false)" class="py-4 glass rounded-2xl font-bold text-[10px] uppercase hover:text-[#a3e635]">Regenerate Image</button>
                            <button onclick="handleStep6()" class="py-4 bg-[#a3e635] text-black rounded-2xl font-extrabold text-[10px] uppercase tracking-widest">Next Phase</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- STEP 7: DISTRIBUTION -->
        <section id="step7" class="step-content hidden max-w-6xl mx-auto">
            <div class="text-center mb-12">
                <h2 class="text-5xl font-extrabold italic tracking-tighter">PROYEK <span class="text-[#a3e635]">SELESAI!</span></h2>
                <p class="text-neutral-500 mt-2">Salin caption dan mulai sebarkan konten Anda.</p>
            </div>
            <div id="distributionList" class="grid md:grid-cols-3 gap-8 mb-12"></div>
            <button onclick="copyFullProject()" class="w-full py-8 glass border-2 border-[#a3e635]/30 rounded-[3rem] text-[#a3e635] font-extrabold text-2xl uppercase italic tracking-tighter hover:bg-[#a3e635]/5 transition-all flex items-center justify-center gap-6">
                <i class="fas fa-file-export"></i> Download All Assets
            </button>
        </section>

    </main>

    <!-- UI Backdrop Decor -->
    <div class="fixed inset-0 pointer-events-none -z-10">
        <div class="absolute -top-[20%] -left-[10%] w-[60%] h-[60%] bg-[#a3e635]/5 blur-[150px] rounded-full"></div>
        <div class="absolute -bottom-[20%] -right-[10%] w-[50%] h-[50%] bg-blue-500/5 blur-[150px] rounded-full"></div>
    </div>

    <script>
        const apiKey = ""; // Diset oleh environment
        let currentStep = 1;
        
        let project = {
            niche: "Life",
            topic: "",
            tone: "Story",
            titles: [],
            selectedTitle: "",
            hooks: [],
            selectedHook: "",
            format: "YouTube Long",
            outline: "",
            script: "",
            thumbnail: { image: null, mainText: "", visualPrompt: "", designReasoning: "" },
            distribution: { instagram: "", tiktok: "", youtube: "" }
        };

        const steps = [
            { id: 1, name: "Konsep", icon: "sparkles" },
            { id: 2, name: "Judul", icon: "type" },
            { id: 3, name: "Hook", icon: "anchor" },
            { id: 4, name: "Struktur", icon: "list-ul" },
            { id: 5, name: "Naskah", icon: "file-signature" },
            { id: 6, name: "Visual", icon: "image" },
            { id: 7, name: "Final", icon: "check-double" }
        ];

        function initApp() {
            renderStepper();
            renderFormatButtons();
        }

        function renderStepper() {
            const container = document.getElementById('navSteps');
            container.innerHTML = steps.map(s => `
                <div class="flex items-center">
                    <button onclick="goToStep(${s.id})" 
                            class="flex items-center gap-2 px-4 py-2 rounded-xl text-[10px] font-bold uppercase transition-all
                                   ${currentStep === s.id ? 'bg-[#a3e635] text-black' : (currentStep > s.id ? 'text-[#a3e635]' : 'text-neutral-600 opacity-50')}"
                            ${currentStep < s.id && !project.topic ? 'disabled' : ''}>
                        <i class="fas fa-${s.icon}"></i> ${s.name}
                    </button>
                    ${s.id !== 7 ? '<div class="w-2 h-[1px] bg-white/10 mx-1"></div>' : ''}
                </div>
            `).join('');
        }

        function renderFormatButtons() {
            const formats = ["YouTube Long", "Shorts/TikTok", "Instagram Carousel", "Twitter Thread"];
            const container = document.getElementById('formatButtons');
            container.innerHTML = formats.map(f => `
                <button onclick="setFormat('${f}')" 
                        class="w-full p-4 rounded-2xl text-[10px] font-bold uppercase text-left border transition-all 
                               ${project.format === f ? 'bg-[#a3e635] text-black border-[#a3e635]' : 'bg-white/5 border-white/5 text-neutral-500'}">
                    ${f}
                </button>
            `).join('');
        }

        function setFormat(f) {
            project.format = f;
            renderFormatButtons();
        }

        function goToStep(s) {
            if (s > currentStep && !project.topic) return;
            document.querySelectorAll('.step-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`step${s}`).classList.remove('hidden');
            currentStep = s;
            renderStepper();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleLoading(show, title = "Processing", msg = "") {
            const overlay = document.getElementById('loadingOverlay');
            document.getElementById('loadingTitle').innerText = title;
            document.getElementById('loadingMsg').innerText = msg;
            overlay.style.display = show ? 'flex' : 'none';
        }

        async function apiRequest(prompt, system, isJson = true) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: system }] },
                generationConfig: isJson ? { responseMimeType: "application/json" } : {}
            };

            let retries = 0;
            while(retries < 5) {
                try {
                    const res = await fetch(url, { method: 'POST', body: JSON.stringify(payload) });
                    const data = await res.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    return isJson ? JSON.parse(text) : text;
                } catch (e) {
                    retries++;
                    await new Promise(r => setTimeout(r, Math.pow(2, retries) * 1000));
                }
            }
            throw new Error("API Max Retries");
        }

        // STEP ACTIONS
        async function handleStep1() {
            project.topic = document.getElementById('topic').value;
            project.niche = document.getElementById('niche').value;
            project.tone = document.getElementById('tone').value;

            if(!project.topic) return;

            toggleLoading(true, "Brainstorming", "AI Headline Specialist sedang meracik judul...");
            
            try {
                const sys = `BERTINDAK SEBAGAI: Viral Headline Specialist. TUGAS: Buat 5 judul organik yang sulit diabaikan. OUTPUT: JSON { titles: [{ text, score, reasoning }] }.`;
                const prompt = `Topik: ${project.topic}. Niche: ${project.niche}. Nuansa: ${project.tone}.`;
                
                const res = await apiRequest(prompt, sys);
                project.titles = res.titles;
                
                const list = document.getElementById('titlesList');
                list.innerHTML = res.titles.map((t, i) => `
                    <button onclick="selectTitle('${t.text.replace(/'/g, "\\'")}')" class="glass glass-hover p-8 rounded-[2rem] text-left flex items-center justify-between group transition-all">
                        <div class="space-y-3">
                            <div class="flex items-center gap-3">
                                <span class="px-3 py-1 bg-[#a3e635] text-black text-[10px] font-extrabold rounded-full uppercase italic">Score: ${t.score}%</span>
                                <span class="text-[10px] font-mono text-neutral-500">#${i+1} • ${t.reasoning}</span>
                            </div>
                            <h3 class="text-2xl font-bold text-neutral-200 group-hover:text-[#a3e635] transition-colors">${t.text}</h3>
                        </div>
                        <i class="fas fa-chevron-right text-neutral-800 group-hover:text-[#a3e635] group-hover:translate-x-1 transition-all"></i>
                    </button>
                `).join('');
                
                goToStep(2);
            } catch (e) { console.error(e); }
            finally { toggleLoading(false); }
        }

        async function selectTitle(title) {
            project.selectedTitle = title;
            toggleLoading(true, "Hook Engineering", "Menganalisis pola perhatian audiens...");
            
            try {
                const sys = `BERTINDAK SEBAGAI: Attention Engineer. TUGAS: Buat 3 hook pembuka. OUTPUT: JSON { hooks: [{ text, psychology }] }.`;
                const res = await apiRequest(`Judul: ${title}`, sys);
                project.hooks = res.hooks;
                
                document.getElementById('hooksList').innerHTML = res.hooks.map(h => `
                    <button onclick="selectHook('${h.text.replace(/'/g, "\\'")}')" class="glass glass-hover p-8 rounded-[2.5rem] text-left flex flex-col justify-between group h-full">
                        <div class="space-y-4">
                            <div class="w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center text-[#a3e635]"><i class="fas fa-anchor"></i></div>
                            <p class="text-lg font-semibold text-neutral-300 leading-relaxed">"${h.text}"</p>
                        </div>
                        <div class="mt-8">
                            <span class="text-[9px] font-bold text-neutral-600 uppercase tracking-widest block mb-1">Psikologi:</span>
                            <span class="text-[10px] font-mono text-neutral-400 italic">${h.psychology}</span>
                        </div>
                    </button>
                `).join('');
                
                goToStep(3);
            } catch (e) { console.error(e); }
            finally { toggleLoading(false); }
        }

        async function selectHook(hook) {
            project.selectedHook = hook;
            toggleLoading(true, "Architecting", "Menyusun kerangka narasi yang solid...");
            
            try {
                const sys = `BERTINDAK SEBAGAI: Content Architect. TUGAS: Susun outline logis. OUTPUT: JSON { outline: string }.`;
                const res = await apiRequest(`Judul: ${project.selectedTitle}. Hook: ${hook}`, sys);
                project.outline = res.outline;
                document.getElementById('outlineArea').value = res.outline;
                goToStep(4);
            } catch (e) { console.error(e); }
            finally { toggleLoading(false); }
        }

        async function handleStep4() {
            project.outline = document.getElementById('outlineArea').value;
            toggleLoading(true, "Writing Script", "Scriptwriter sedang menulis naskah lengkap...");
            
            try {
                const sys = `BERTINDAK SEBAGAI: Master Copywriter. TUGAS: Tulis naskah penuh dengan format [SCENE] dan instruksi visual.`;
                const res = await apiRequest(`Struktur: ${project.outline}. Format: ${project.format}`, sys, false);
                project.script = res;
                document.getElementById('scriptArea').value = res;
                goToStep(5);
            } catch (e) { console.error(e); }
            finally { toggleLoading(false); }
        }

        async function handleStep5(isNew = true) {
            project.script = document.getElementById('scriptArea').value;
            toggleLoading(true, "Visual Concept", "Membangun identitas visual konten...");
            
            try {
                if (isNew) {
                    const sys = `BERTINDAK SEBAGAI: Visual Strategist. TUGAS: Rancang desain thumbnail. OUTPUT: JSON { mainText, visualPrompt, designReasoning }.`;
                    const res = await apiRequest(`Naskah: ${project.script.slice(0, 400)}`, sys);
                    project.thumbnail = { ...project.thumbnail, ...res };
                    document.getElementById('mainVisualText').value = res.mainText;
                    document.getElementById('visualPrompt').value = res.visualPrompt;
                    document.getElementById('designReasoning').innerText = res.designReasoning;
                } else {
                    project.thumbnail.mainText = document.getElementById('mainVisualText').value;
                    project.thumbnail.visualPrompt = document.getElementById('visualPrompt').value;
                }

                const container = document.getElementById('visualContainer');
                container.innerHTML = `<div class="flex flex-col items-center gap-4">
                    <div class="loader-ring"></div>
                    <span class="text-[10px] font-mono uppercase tracking-widest text-[#a3e635]">Rendering AI Art...</span>
                </div>`;

                const ratio = project.format.includes("Shorts") ? "9:16" : "16:9";
                const imgPrompt = `${project.thumbnail.visualPrompt}, bold cinematic lighting, text overlay "${project.thumbnail.mainText}", ultra high resolution`;
                
                const imgRes = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`, {
                    method: 'POST',
                    body: JSON.stringify({ instances: [{ prompt: imgPrompt }], parameters: { sampleCount: 1, aspectRatio: ratio } })
                });
                const imgData = await imgRes.json();
                const b64 = imgData.predictions[0].bytesBase64Encoded;
                
                project.thumbnail.image = `data:image/png;base64,${b64}`;
                container.className = `glass rounded-[3rem] overflow-hidden ${ratio === "9:16" ? 'aspect-[9/16] w-[300px] mx-auto' : 'aspect-video w-full'}`;
                container.innerHTML = `<img src="${project.thumbnail.image}" class="w-full h-full object-cover">`;
                
                goToStep(6);
            } catch (e) { console.error(e); }
            finally { toggleLoading(false); }
        }

        async function handleStep6() {
            toggleLoading(true, "Finalizing", "Menyiapkan paket distribusi...");
            
            try {
                const sys = `BERTINDAK SEBAGAI: Distribution Manager. TUGAS: Buat caption media sosial. OUTPUT: JSON { instagram, tiktok, youtube }.`;
                const res = await apiRequest(`Naskah: ${project.script.slice(0, 400)}`, sys);
                project.distribution = res;
                
                const list = document.getElementById('distributionList');
                const p = [
                    { id: 'instagram', icon: 'instagram', color: 'bg-pink-500/10 text-pink-500' },
                    { id: 'tiktok', icon: 'tiktok', color: 'bg-white/10 text-white' },
                    { id: 'youtube', icon: 'youtube', color: 'bg-red-500/10 text-red-500' }
                ];
                
                list.innerHTML = p.map(item => `
                    <div class="glass p-8 rounded-[2.5rem] flex flex-col">
                        <div class="flex items-center gap-3 mb-6">
                            <div class="w-8 h-8 rounded-lg flex items-center justify-center ${item.color}"><i class="fab fa-${item.icon}"></i></div>
                            <span class="text-xs font-bold uppercase tracking-widest">${item.id}</span>
                        </div>
                        <div class="flex-1 bg-black/40 p-5 rounded-2xl border border-white/5 font-mono text-[11px] text-neutral-400 mb-6 overflow-y-auto max-h-40 leading-relaxed">
                            ${res[item.id]}
                        </div>
                        <button onclick="copyRawText('${item.id}')" class="w-full py-3 glass rounded-xl text-[10px] font-bold uppercase hover:text-[#a3e635] transition-all">Copy Caption</button>
                    </div>
                `).join('');
                
                goToStep(7);
            } catch (e) { console.error(e); }
            finally { toggleLoading(false); }
        }

        function copyRawText(key) {
            navigator.clipboard.writeText(project.distribution[key]);
        }

        function copyToClipboard(id) {
            const area = document.getElementById(id);
            area.select();
            document.execCommand('copy');
        }

        function copyFullProject() {
            const data = `PROJECT: ${project.selectedTitle}\n\nHOOK: ${project.selectedHook}\n\nSCRIPT:\n${project.script}\n\nCAPTION IG:\n${project.distribution.instagram}`;
            navigator.clipboard.writeText(data);
        }

        window.onload = initApp;
    </script>
</body>
</html>
