<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nyetak ACG Cinema - OpenAI Version</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200;0,400;0,700;0,800;1,800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #050505;
            color: #d4d4d4;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #0a0a0a;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #262626;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #a3e635;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse-slow {
            animation: pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="selection:bg-[#a3e635] selection:text-black">

    <div id="app">
        <!-- Navigation -->
        <nav class="sticky top-0 z-50 bg-[#0A0A0A]/80 backdrop-blur-xl border-b border-neutral-800 px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="bg-[#a3e635] p-2 rounded-lg rotate-3 shadow-[0_0_20px_rgba(163,230,53,0.4)]">
                    <i data-lucide="zap" class="text-black w-5 h-5"></i>
                </div>
                <div class="flex flex-col">
                    <span class="font-black tracking-tighter text-white uppercase italic text-xl leading-none">
                        NYETAK <span class="text-[#a3e635]">CINEMA</span>
                    </span>
                    <span class="text-[8px] font-bold text-neutral-500 uppercase tracking-widest mt-0.5">Stability OpenAI v6.2</span>
                </div>
            </div>
            <div id="progress-dots" class="hidden md:flex gap-2"></div>
            <div class="flex gap-4 items-center">
                <button class="text-neutral-500 hover:text-white transition-colors"><i data-lucide="settings" class="w-5 h-5"></i></button>
                <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-neutral-800 to-neutral-700 border border-neutral-700 flex items-center justify-center text-[10px] font-bold text-white uppercase">NC</div>
            </div>
        </nav>

        <main id="main-content" class="max-w-7xl mx-auto p-6 md:p-12 min-h-screen">
            <!-- Content Injected by JS -->
        </main>

        <!-- Loading Overlay -->
        <div id="loading-overlay" class="fixed inset-0 z-[100] bg-black/95 backdrop-blur-xl hidden flex flex-col items-center justify-center text-center p-8">
            <div class="relative mb-14 scale-150">
                <div class="absolute inset-0 bg-[#a3e635]/30 blur-[100px] animate-pulse-slow rounded-full"></div>
                <div class="relative z-10 p-8 border border-[#a3e635]/20 rounded-full">
                    <i data-lucide="loader-2" class="animate-spin text-[#a3e635] w-16 h-16"></i>
                </div>
            </div>
            <h2 class="text-5xl font-black text-white uppercase italic tracking-tighter mb-4 leading-none">Integrasi <br/>OpenAI GPT-4o</h2>
            <p id="loading-msg" class="text-[#a3e635] font-mono text-[10px] uppercase tracking-[0.8em] animate-pulse">Memproses...</p>
        </div>

        <!-- Error Toast -->
        <div id="error-toast" class="fixed bottom-12 left-1/2 -translate-x-1/2 z-[110] bg-black/90 border border-red-500/40 p-8 pr-16 rounded-[2.5rem] backdrop-blur-3xl hidden items-center gap-6 shadow-2xl">
            <div class="bg-red-500 p-4 rounded-2xl text-black">
                <i data-lucide="alert-circle" class="w-7 h-7"></i>
            </div>
            <div class="text-left">
                <p class="text-[10px] font-black text-red-500 uppercase tracking-[0.3em] mb-1">OpenAI Error</p>
                <p id="error-msg" class="text-lg font-bold text-red-100 italic tracking-tight"></p>
            </div>
            <button onclick="hideError()" class="absolute right-6 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full flex items-center justify-center text-red-500 hover:bg-red-500 hover:text-white transition-all">âœ•</button>
        </div>
    </div>

    <script>
        // Masukkan API Key OpenAI Anda di sini
        const openAiApiKey = "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"; 
        
        let currentStep = 1;
        let project = {
            topic: "",
            tone: "Storytelling",
            format: "YouTube Long Video",
            titles: [],
            selectedTitle: "",
        };

        let isPlaying = false;

        const initLucide = () => lucide.createIcons();

        const showLoading = (msg) => {
            const overlay = document.getElementById('loading-overlay');
            document.getElementById('loading-msg').innerText = msg;
            overlay.classList.remove('hidden');
            overlay.classList.add('flex');
        };

        const hideLoading = () => {
            const overlay = document.getElementById('loading-overlay');
            overlay.classList.add('hidden');
            overlay.classList.remove('flex');
        };

        const showError = (msg) => {
            const toast = document.getElementById('error-toast');
            document.getElementById('error-msg').innerText = msg;
            toast.classList.remove('hidden');
            toast.classList.add('flex');
            setTimeout(hideError, 8000);
        };

        const hideError = () => {
            document.getElementById('error-toast').classList.add('hidden');
        };

        /**
         * Fungsi pemanggilan OpenAI Chat Completion API
         */
        const callOpenAI = async (prompt, systemPrompt, isJson = true, retries = 3, backoff = 1000) => {
            if (!openAiApiKey) {
                throw new Error("API Key OpenAI belum diatur. Silakan isi variabel openAiApiKey di dalam kode.");
            }

            const payload = {
                model: "gpt-4o",
                messages: [
                    { role: "system", content: systemPrompt },
                    { role: "user", content: prompt }
                ],
                temperature: 0.7,
                response_format: isJson ? { type: "json_object" } : { type: "text" }
            };

            try {
                const response = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${openAiApiKey}`
                    },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    if (retries > 0 && (response.status === 429 || response.status >= 500)) {
                        await new Promise(r => setTimeout(r, backoff));
                        return callOpenAI(prompt, systemPrompt, isJson, retries - 1, backoff * 2);
                    }
                    throw new Error(errorData.error?.message || "Gagal menghubungi OpenAI.");
                }

                const data = await response.json();
                const content = data.choices[0].message.content;
                
                return isJson ? JSON.parse(content) : content;
            } catch (err) {
                if (retries > 0) {
                    await new Promise(r => setTimeout(r, backoff));
                    return callOpenAI(prompt, systemPrompt, isJson, retries - 1, backoff * 2);
                }
                throw err;
            }
        };

        const renderDots = () => {
            const container = document.getElementById('progress-dots');
            container.innerHTML = '';
            for(let i=1; i<=6; i++) {
                const dot = document.createElement('div');
                dot.className = `h-1.5 w-8 rounded-full transition-all duration-500 ${currentStep >= i ? 'bg-[#a3e635]' : 'bg-neutral-800'}`;
                container.appendChild(dot);
            }
        };

        const setStep = (step) => {
            currentStep = step;
            renderDots();
            renderContent();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        const renderContent = () => {
            const main = document.getElementById('main-content');
            
            if (currentStep === 1) {
                main.innerHTML = `
                    <div class="max-w-2xl mx-auto space-y-12 animate-in fade-in slide-in-from-bottom-8">
                        <header class="text-center space-y-6">
                            <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-[#a3e635]/10 border border-[#a3e635]/20 text-[#a3e635] text-[10px] font-black uppercase tracking-[0.2em]">
                                <i data-lucide="zap" class="w-3 h-3"></i> OpenAI Engine Ready
                            </div>
                            <h1 class="text-5xl md:text-7xl font-black text-white uppercase italic tracking-tighter leading-[0.9]">
                                CIPTAKAN <span class="text-[#a3e635]">VIRALITAS.</span>
                            </h1>
                        </header>
                        <div class="bg-neutral-900/40 border border-neutral-800 p-10 rounded-[3.5rem] space-y-8 shadow-2xl backdrop-blur-md">
                            <div class="space-y-4">
                                <label class="text-[10px] font-black text-neutral-500 uppercase tracking-widest ml-2 flex items-center gap-2">
                                    <i data-lucide="type" class="w-3 h-3"></i> Topik Konten Utama
                                </label>
                                <textarea id="input-topic" class="w-full h-40 bg-black/60 border border-neutral-800 p-8 rounded-3xl outline-none focus:border-[#a3e635] text-lg font-medium text-white resize-none" placeholder="Misal: Sejarah terlarang yang disembunyikan...">${project.topic}</textarea>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <select id="input-tone" class="w-full bg-black/60 border border-neutral-800 p-5 rounded-2xl outline-none text-xs font-bold uppercase text-white">
                                    <option value="Mind-Blowing">Mind-Blowing</option>
                                    <option value="Storytelling" ${project.tone === 'Storytelling' ? 'selected' : ''}>Storytelling</option>
                                    <option value="Misteri">Misteri</option>
                                </select>
                                <select id="input-format" class="w-full bg-black/60 border border-neutral-800 p-5 rounded-2xl outline-none text-xs font-bold uppercase text-white">
                                    <option value="YouTube Long Video">YouTube Long Video</option>
                                    <option value="TikTok / Shorts">TikTok / Shorts</option>
                                </select>
                            </div>
                            <button onclick="handleProcessStep1()" class="w-full py-7 bg-[#a3e635] text-black font-black uppercase tracking-[0.4em] rounded-2xl hover:scale-[1.02] active:scale-[0.98] transition-all">GENERATE VIA OPENAI</button>
                        </div>
                    </div>
                `;
            } else if (currentStep === 2) {
                main.innerHTML = `
                    <div class="max-w-4xl mx-auto space-y-8 animate-in slide-in-from-right-12">
                        <div class="flex items-center justify-between mb-8">
                            <div class="flex items-center gap-4">
                                <button onclick="setStep(1)" class="p-3 bg-neutral-900 rounded-2xl border border-neutral-800"><i data-lucide="chevron-left"></i></button>
                                <h2 class="text-4xl font-black text-white italic tracking-tighter uppercase">Judul <span class="text-[#a3e635]">Viral</span></h2>
                            </div>
                        </div>
                        <div class="grid gap-5">
                            ${project.titles.map((t, i) => `
                                <button onclick="handleProcessStep2('${t.text.replace(/'/g, "\\'")}')" class="bg-neutral-900/60 p-10 rounded-[3rem] flex items-center justify-between border border-neutral-800 hover:border-[#a3e635] transition-all group text-left">
                                    <div class="flex-1 pr-12">
                                        <span class="text-[10px] font-black text-[#a3e635] bg-[#a3e635]/10 px-3 py-1 rounded-lg uppercase border border-[#a3e635]/20">Click-Score: ${t.score}%</span>
                                        <h3 class="text-3xl font-bold text-white mt-4">${t.text}</h3>
                                        <p class="text-xs text-neutral-500 uppercase mt-2">${t.reasoning || ''}</p>
                                    </div>
                                    <div class="bg-black/40 p-5 rounded-full group-hover:bg-[#a3e635] group-hover:text-black transition-all">
                                        <i data-lucide="chevron-right"></i>
                                    </div>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else if (currentStep === 6) {
                main.innerHTML = `
                    <div class="max-w-6xl mx-auto animate-in zoom-in-95">
                        <div class="flex flex-col lg:flex-row gap-16">
                            <div class="flex-1 space-y-10">
                                <div class="relative bg-neutral-900 rounded-[4rem] overflow-hidden shadow-2xl border border-neutral-800 aspect-video">
                                    <img src="https://images.unsplash.com/photo-1536440136628-849c177e76a1?auto=format&fit=crop&q=80&w=1280" class="w-full h-full object-cover opacity-60">
                                    <div class="absolute inset-0 bg-gradient-to-t from-black flex flex-col justify-end p-14">
                                        <h3 class="text-4xl md:text-6xl font-black text-white italic tracking-tighter leading-[0.85]">${project.selectedTitle}</h3>
                                    </div>
                                    <button onclick="toggleAudio()" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-32 h-32 bg-[#a3e635] rounded-full flex items-center justify-center text-black shadow-2xl">
                                        <i id="play-icon" data-lucide="${isPlaying ? 'pause' : 'play'}" class="w-10 h-10 ${isPlaying ? '' : 'ml-2'}"></i>
                                    </button>
                                </div>
                                <div class="grid grid-cols-3 gap-8">
                                    <button class="bg-neutral-900 p-8 rounded-[2.5rem] border border-neutral-800 flex flex-col items-center gap-4">
                                        <i data-lucide="download" class="text-[#a3e635]"></i>
                                        <span class="text-[8px] font-black uppercase tracking-widest text-neutral-500">SAVE MP4</span>
                                    </button>
                                    <button onclick="location.reload()" class="bg-neutral-900 p-8 rounded-[2.5rem] border border-neutral-800 flex flex-col items-center gap-4">
                                        <i data-lucide="refresh-ccw" class="text-[#a3e635]"></i>
                                        <span class="text-[8px] font-black uppercase tracking-widest text-neutral-500">ULANGI</span>
                                    </button>
                                    <button class="bg-neutral-900 p-8 rounded-[2.5rem] border border-neutral-800 flex flex-col items-center gap-4">
                                        <i data-lucide="share-2" class="text-[#a3e635]"></i>
                                        <span class="text-[8px] font-black uppercase tracking-widest text-neutral-500">SHARE</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            initLucide();
        };

        const handleProcessStep1 = async () => {
            const topic = document.getElementById('input-topic').value;
            if (!topic.trim()) {
                showError("Masukkan topik terlebih dahulu.");
                return;
            }
            
            project.topic = topic;
            project.tone = document.getElementById('input-tone').value;
            project.format = document.getElementById('input-format').value;

            showLoading("Memanggil API OpenAI...");
            try {
                const sys = `Anda adalah Spesialis Viral Marketing. Berikan jawaban dalam JSON format: { "titles": [{ "text": "string", "score": number, "reasoning": "string" }] }. Fokus pada clickbait psikologis namun akurat.`;
                const prompt = `Berikan 3 ide judul viral untuk video tentang: "${project.topic}". Nada: ${project.tone}. Platform: ${project.format}. Bahasa Indonesia.`;
                
                const res = await callOpenAI(prompt, sys);
                if (res && res.titles) {
                    project.titles = res.titles;
                    setStep(2);
                }
            } catch (e) { 
                showError(e.message); 
            } finally { 
                hideLoading(); 
            }
        };

        const handleProcessStep2 = async (title) => {
            project.selectedTitle = title;
            showLoading("Menyiapkan Workspace...");
            setTimeout(() => {
                setStep(6);
                hideLoading();
            }, 800);
        };

        const toggleAudio = () => {
            isPlaying = !isPlaying;
            renderContent();
        };

        window.onload = () => setStep(1);
    </script>
</body>
</html>
