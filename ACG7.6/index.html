<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACG v6.7 - Ultimate AI Content Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');
        
        :root {
            --primary: #3b82f6;
            --accent: #9333ea;
            --bg: #030712;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg);
            color: #f8fafc;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.1), transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(147, 51, 234, 0.1), transparent 40%);
        }
        
        .glass {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .btn-gradient {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 50%, #d946ef 100%);
            background-size: 200% auto;
            transition: 0.5s;
        }

        .btn-gradient:hover:not(:disabled) {
            background-position: right center;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
        }

        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => { 
                if (window.lucide) window.lucide.createIcons(); 
            }, [name]);
            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        const STEPS = [
            { id: 1, label: 'Ide', icon: 'lightbulb', guide: "Masukkan topik konten Anda. API Key telah terkonfigurasi otomatis." },
            { id: 2, label: 'Judul', icon: 'heading', guide: "Pilih judul yang paling memancing rasa penasaran audiens." },
            { id: 3, label: 'Hook', icon: 'magnet', guide: "Pilih kalimat pembuka yang kuat untuk menahan retensi." },
            { id: 4, label: 'Naskah', icon: 'align-left', guide: "Naskah narasi dan caption Anda telah selesai disusun." },
            { id: 5, label: 'Visual', icon: 'camera', guide: "Gunakan deskripsi visual ini untuk membuat video di AI generator." },
            { id: 6, label: 'Siap', icon: 'check-circle', guide: "Semua aset konten Anda telah siap dipublikasikan." }
        ];

        const App = () => {
            // API Key default baru
            const [apiKey, setApiKey] = useState("AIzaSyAbKZEm6GPDAOqaISbRIQkEQlGWLg6hoag");
            const [showSettings, setShowSettings] = useState(false);
            const [currentStep, setCurrentStep] = useState(1);
            const [loading, setLoading] = useState(false);
            const [loadingMsg, setLoadingMsg] = useState("");
            const [error, setError] = useState(null);
            
            const [data, setData] = useState({
                topic: "",
                titles: [],
                selectedTitle: "",
                hooks: [],
                selectedHook: "",
                script: "",
                imagePrompts: [],
                caption: ""
            });

            // Sinkronisasi dengan localStorage saat load
            useEffect(() => {
                const savedKey = localStorage.getItem('acg_gemini_key');
                if (savedKey) {
                    setApiKey(savedKey);
                } else {
                    // Jika belum ada di storage, simpan key default yang baru diset
                    localStorage.setItem('acg_gemini_key', apiKey);
                }
            }, []);

            const saveApiKey = (key) => {
                setApiKey(key);
                localStorage.setItem('acg_gemini_key', key);
                setShowSettings(false);
            };

            const copyToClipboard = (text, msg = "Berhasil disalin!") => {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            };

            const callGemini = async (prompt, systemPrompt) => {
                if (!apiKey) {
                    setShowSettings(true);
                    throw new Error("API Key belum diatur.");
                }

                // Menggunakan model Gemini 2.5 Flash sesuai spesifikasi lingkungan
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{
                        parts: [{ text: `${systemPrompt}\n\nUSER INPUT: ${prompt}` }]
                    }],
                    generationConfig: {
                        responseMimeType: "application/json"
                    }
                };

                let delay = 1000;
                for (let i = 0; i < 5; i++) {
                    try {
                        const response = await fetch(url, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        
                        if (!response.ok) {
                            const errorData = await response.json();
                            if (errorData.error?.status === "UNAUTHENTICATED" || errorData.error?.message.includes("API key")) {
                                setShowSettings(true);
                                throw new Error("API Key tidak valid atau telah kedaluwarsa.");
                            }
                            throw new Error(errorData.error?.message || "Gangguan pada API Gemini.");
                        }
                        
                        const result = await response.json();
                        const textResponse = result.candidates?.[0]?.content?.parts?.[0]?.text;
                        return JSON.parse(textResponse);
                    } catch (e) {
                        if (i === 4 || e.message.includes("API Key")) throw e;
                        await new Promise(r => setTimeout(r, delay));
                        delay *= 2;
                    }
                }
            };

            const handleStart = async () => {
                if (!data.topic.trim()) return;
                setLoading(true); 
                setLoadingMsg("AI sedang merancang konsep viral..."); 
                setError(null);
                try {
                    const res = await callGemini(
                        data.topic, 
                        "Anda adalah direktur kreatif media sosial. Buat 4 judul video pendek (Reels/TikTok) yang memancing klik. Respon harus dalam format JSON: { \"titles\": [{\"text\": \"Judul\", \"viral_potential\": \"High/Medium\"}] }"
                    );
                    setData(p => ({ ...p, titles: res.titles }));
                    setCurrentStep(2);
                } catch (e) { setError(`Gagal: ${e.message}`); } finally { setLoading(false); }
            };

            const handleTitleSelect = async (t) => {
                setLoading(true); 
                setLoadingMsg("Merancang hook psikologis..."); 
                setData(p => ({ ...p, selectedTitle: t }));
                try {
                    const res = await callGemini(
                        t, 
                        "Buat 3 opsi hook yang menahan retensi. Respon harus dalam format JSON: { \"hooks\": [\"Hook 1\", \"Hook 2\", \"Hook 3\"] }"
                    );
                    setData(p => ({ ...p, hooks: res.hooks }));
                    setCurrentStep(3);
                } catch (e) { setError(e.message); } finally { setLoading(false); }
            };

            const handleHookSelect = async (h) => {
                setLoading(true); 
                setLoadingMsg("Menulis skenario konten..."); 
                setData(p => ({ ...p, selectedHook: h }));
                try {
                    const res = await callGemini(
                        `Judul: ${data.selectedTitle}, Hook: ${h}`, 
                        "Tulis naskah video lengkap dan caption untuk Instagram/TikTok dengan hashtag relevan. Respon harus dalam format JSON: { \"script\": \"...\", \"caption\": \"...\" }"
                    );
                    setData(p => ({ ...p, script: res.script, caption: res.caption }));
                    setCurrentStep(4);
                } catch (e) { setError(e.message); } finally { setLoading(false); }
            };

            const handleGoToVisual = async () => {
                setLoading(true); 
                setLoadingMsg("Menganalisis scene visual...");
                try {
                    const res = await callGemini(
                        data.script, 
                        "Deskripsikan 3 scene visual detail dalam bahasa Inggris untuk generator AI Video. Respon harus dalam format JSON: { \"imagePrompts\": [{\"scene\": \"Scene Title\", \"prompt\": \"Visual description\"}] }"
                    );
                    setData(p => ({ ...p, imagePrompts: res.imagePrompts }));
                    setCurrentStep(5);
                } catch (e) { setError(e.message); } finally { setLoading(false); }
            };

            return (
                <div className="max-w-5xl mx-auto px-6 py-8 md:py-16">
                    {/* Header */}
                    <header className="flex justify-between items-center mb-12">
                        <div className="flex items-center gap-5">
                            <div className="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center shadow-xl shadow-blue-500/20">
                                <Icon name="bot" className="text-white" size={24}/>
                            </div>
                            <div>
                                <h1 className="text-2xl font-black tracking-tighter uppercase italic">ACG <span className="text-blue-500">ULTIMATE</span></h1>
                                <span className="text-[9px] text-zinc-500 font-bold tracking-[0.3em] uppercase">v6.7 Gemini Engine</span>
                            </div>
                        </div>
                        
                        <button onClick={() => setShowSettings(true)} className="p-3 glass rounded-xl border-white/5 hover:border-blue-500/50 transition-all">
                            <Icon name="settings" size={20} className="text-zinc-400" />
                        </button>
                    </header>

                    {/* API Settings Modal */}
                    {showSettings && (
                        <div className="fixed inset-0 bg-black/80 backdrop-blur-md z-[60] flex items-center justify-center p-6">
                            <div className="glass p-8 rounded-[2.5rem] w-full max-w-md border-blue-500/20 shadow-2xl">
                                <h3 className="text-xl font-bold mb-2">Konfigurasi API Key</h3>
                                <p className="text-sm text-zinc-400 mb-6">Kelola Gemini API Key Anda untuk akses mesin AI.</p>
                                <input 
                                    type="password" 
                                    placeholder="AIzaSy..." 
                                    className="w-full bg-black/40 border border-white/10 rounded-2xl p-4 text-sm font-mono mb-4 focus:border-blue-500 outline-none"
                                    value={apiKey}
                                    onChange={(e) => setApiKey(e.target.value)}
                                />
                                <button 
                                    onClick={() => saveApiKey(apiKey)}
                                    className="w-full py-4 btn-gradient rounded-2xl text-[11px] font-black uppercase tracking-widest"
                                >
                                    SIMPAN KONFIGURASI
                                </button>
                                <button 
                                    onClick={() => setShowSettings(false)}
                                    className="w-full mt-2 py-2 text-[10px] text-zinc-500 uppercase font-bold tracking-widest hover:text-white"
                                >
                                    BATAL
                                </button>
                            </div>
                        </div>
                    )}

                    <main className="fade-in min-h-[500px]">
                        {error && (
                            <div className="mb-8 p-5 glass border-red-500/30 rounded-2xl text-red-400 text-xs flex items-center justify-between gap-4">
                                <div className="flex items-center gap-3">
                                    <Icon name="alert-circle" size={18}/> 
                                    <p className="font-bold">{error}</p>
                                </div>
                                <button onClick={() => setError(null)} className="text-lg">&times;</button>
                            </div>
                        )}

                        {/* Step 1: Input Topic */}
                        {currentStep === 1 && (
                            <div className="glass p-8 md:p-12 rounded-[3.5rem] border-white/5 relative">
                                <div className="absolute top-8 left-8 text-[9px] font-black uppercase tracking-[0.5em] text-zinc-700">Content Planner</div>
                                <textarea 
                                    className="w-full bg-transparent border-none text-3xl md:text-5xl font-black outline-none resize-none min-h-[220px] placeholder:text-zinc-800 leading-tight mt-6 focus:ring-0 italic" 
                                    placeholder="Apa ide konten viral Anda hari ini?" 
                                    value={data.topic} 
                                    onChange={e => setData({...data, topic: e.target.value})} 
                                />
                                <div className="mt-8">
                                    <button onClick={handleStart} disabled={!data.topic.trim() || loading} className="w-full py-7 rounded-[2rem] btn-gradient text-[12px] font-black uppercase tracking-[0.4em] flex items-center justify-center gap-4 disabled:opacity-20 shadow-xl">
                                        START ENGINE <Icon name="zap" size={18} />
                                    </button>
                                </div>
                            </div>
                        )}

                        {/* Step 2: Title Selection */}
                        {currentStep === 2 && (
                            <div className="grid gap-6">
                                {data.titles.map((t, i) => (
                                    <button key={i} onClick={() => handleTitleSelect(t.text)} className="glass p-8 rounded-[2.5rem] text-left flex justify-between items-center group border border-white/5 hover:border-blue-500/40 transition-all">
                                        <div className="flex-1">
                                            <span className="font-black text-2xl group-hover:text-blue-400 transition-colors block mb-1 italic">"{t.text}"</span>
                                            <span className="text-[10px] font-bold text-blue-500/70 uppercase tracking-widest">Viral Potential: {t.viral_potential}</span>
                                        </div>
                                        <Icon name="chevron-right" size={24} className="text-zinc-800 group-hover:text-blue-500 transition-all" />
                                    </button>
                                ))}
                            </div>
                        )}

                        {/* Step 3: Hook Selection */}
                        {currentStep === 3 && (
                            <div className="grid gap-6">
                                {data.hooks.map((h, i) => (
                                    <button key={i} onClick={() => handleHookSelect(h)} className="glass p-10 rounded-[3rem] text-left flex items-start gap-8 group border border-white/5 hover:border-blue-500/40 transition-all">
                                        <div className="w-12 h-12 rounded-2xl bg-blue-500/10 border border-blue-500/20 flex items-center justify-center text-blue-500 font-black shrink-0 group-hover:bg-blue-600 group-hover:text-white transition-all">0{i+1}</div>
                                        <p className="text-xl font-bold text-zinc-300 leading-snug group-hover:text-white">"{h}"</p>
                                    </button>
                                ))}
                            </div>
                        )}

                        {/* Step 4: Script & Caption */}
                        {currentStep === 4 && (
                            <div className="space-y-8">
                                <div className="glass p-10 rounded-[3rem] border-white/5 space-y-6">
                                    <div className="flex justify-between items-center border-b border-white/5 pb-6">
                                        <h3 className="text-[10px] font-black uppercase tracking-[0.3em] text-blue-500">Video Script Output</h3>
                                        <button onClick={() => copyToClipboard(data.script)} className="p-2 bg-white/5 rounded-lg text-zinc-500 hover:text-white transition-all">
                                            <Icon name="copy" size={16} />
                                        </button>
                                    </div>
                                    <div className="font-mono text-base text-zinc-400 whitespace-pre-wrap leading-relaxed max-h-[350px] overflow-y-auto custom-scrollbar italic pr-4">
                                        {data.script}
                                    </div>
                                </div>
                                <button onClick={handleGoToVisual} className="w-full py-7 btn-gradient rounded-[2rem] text-[12px] font-black uppercase tracking-[0.4em] flex items-center justify-center gap-3">
                                    EXTRACT VISUAL PROMPTS <Icon name="eye" size={20} />
                                </button>
                            </div>
                        )}

                        {/* Step 5: Visual Prompts */}
                        {currentStep === 5 && (
                            <div className="space-y-6">
                                {data.imagePrompts.map((p, i) => (
                                    <div key={i} className="glass p-10 rounded-[3rem] border-white/5 space-y-4">
                                        <div className="flex justify-between items-center">
                                            <span className="text-[11px] font-black uppercase tracking-widest text-blue-500">{p.scene}</span>
                                            <button onClick={() => copyToClipboard(p.prompt)} className="p-2 text-zinc-600 hover:text-white"><Icon name="copy" size={18} /></button>
                                        </div>
                                        <p className="text-zinc-400 font-mono text-sm leading-relaxed p-6 bg-black/40 rounded-2xl italic">
                                            {p.prompt}
                                        </p>
                                    </div>
                                ))}
                                <button onClick={() => setCurrentStep(6)} className="w-full py-7 btn-gradient rounded-[2rem] text-[12px] font-black uppercase tracking-[0.4em] mt-10">
                                    COMPLETE PROJECT <Icon name="check" size={20} />
                                </button>
                            </div>
                        )}

                        {/* Step 6: Final Result */}
                        {currentStep === 6 && (
                            <div className="glass p-16 rounded-[5rem] text-center space-y-12 border-blue-500/20 shadow-2xl">
                                <div className="w-20 h-20 bg-blue-600 rounded-[2rem] flex items-center justify-center mx-auto shadow-2xl rotate-12"><Icon name="rocket" size={40} className="text-white" /></div>
                                <div className="space-y-2">
                                    <h2 className="text-5xl font-black italic uppercase tracking-tighter">MISSION <span className="text-blue-500">ACCOMPLISHED</span></h2>
                                    <p className="text-zinc-500 text-[10px] font-bold uppercase tracking-[0.5em]">Your Viral Content is Ready for Launch</p>
                                </div>
                                <div className="bg-black/40 p-10 rounded-[3.5rem] text-left border border-white/5 relative">
                                    <p className="text-xl font-medium text-zinc-300 leading-relaxed italic pr-12">"{data.caption}"</p>
                                    <button onClick={() => copyToClipboard(data.caption)} className="absolute bottom-6 right-6 p-3 bg-white/5 hover:bg-blue-600 rounded-xl transition-all"><Icon name="copy" size={20} /></button>
                                </div>
                                <button onClick={() => window.location.reload()} className="w-full py-6 border border-white/10 rounded-[2.5rem] text-[10px] font-black uppercase tracking-[0.4em] text-zinc-500 hover:text-white transition-all">START NEW PROJECT</button>
                            </div>
                        )}
                    </main>

                    {/* Global Loading Overlay */}
                    {loading && (
                        <div className="fixed inset-0 bg-black/95 backdrop-blur-2xl flex flex-col items-center justify-center z-[100]">
                            <div className="w-16 h-16 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-10"></div>
                            <p className="text-[12px] font-black uppercase tracking-[0.8em] text-blue-500 shimmer">{loadingMsg}</p>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
