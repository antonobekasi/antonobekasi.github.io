<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACG v6.5 - OpenAI Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --accent: #10a37f;
            --bg-light: #F8F9FC;
            --card-light: rgba(255, 255, 255, 0.7);
            --text-light: #1A1C1E;
        }

        .dark-mode {
            --bg-light: #050505;
            --card-light: rgba(18, 18, 18, 0.7);
            --text-light: #F4F4F5;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-light);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 0;
            overflow-x: hidden;
        }

        .bento-card {
            background: var(--card-light);
            backdrop-filter: blur(24px) saturate(200%);
            -webkit-backdrop-filter: blur(24px) saturate(200%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 28px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .btn-openai {
            background: linear-gradient(135deg, #10a37f 0%, #007858 100%);
            box-shadow: 0 10px 25px -5px rgba(16, 163, 127, 0.3);
        }

        .shimmer-text {
            background: linear-gradient(90deg, var(--text-light) 0%, #10a37f 50%, var(--text-light) 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shimmer 4s linear infinite;
        }

        @keyframes shimmer {
            to { background-position: 200% center; }
        }

        .input-glass {
            background: rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: 20px;
        }
        .dark-mode .input-glass {
            background: rgba(255, 255, 255, 0.03);
            border-color: rgba(255, 255, 255, 0.05);
        }

        /* Fixed Overlay Positions */
        .assistant-top-dock {
            position: fixed;
            top: 24px;
            right: 24px;
            width: 320px;
            z-index: 100; /* Lower than sidebar but higher than content */
        }

        @media (max-width: 1024px) {
            .assistant-top-dock {
                position: relative;
                top: 0;
                right: 0;
                width: 100%;
                margin-bottom: 2rem;
            }
        }

        .ai-orb {
            width: 48px;
            height: 48px;
            background: radial-gradient(circle at 30% 30%, #10a37f 0%, #054a3a 100%);
            border-radius: 50%;
            position: relative;
            box-shadow: 0 0 20px rgba(16, 163, 127, 0.4);
            overflow: hidden;
        }

        .visualizer {
            display: flex;
            align-items: center;
            gap: 3px;
            height: 16px;
        }

        .bar {
            width: 2px;
            background: #10a37f;
            border-radius: 4px;
            animation: bar-dance 0.8s ease-in-out infinite;
        }

        @keyframes bar-dance {
            0%, 100% { height: 4px; opacity: 0.5; }
            50% { height: 12px; opacity: 1; }
        }

        .media-preview-box {
            background: rgba(0,0,0,0.05);
            border-radius: 20px;
            border: 2px dashed rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        .dark-mode .media-preview-box {
            background: rgba(255,255,255,0.03);
            border-color: rgba(255,255,255,0.1);
        }

        .loading-pulse {
            animation: pulse-bg 2s infinite;
        }
        @keyframes pulse-bg {
            0% { opacity: 0.4; }
            50% { opacity: 1; }
            100% { opacity: 0.4; }
        }
    </style>
</head>
<body class="light-mode">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // API Key is handled by the execution environment at runtime if empty
        const apiKey = "";

        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                zap: <path d="M13 2 L3 14h9l-1 8 10-12h-9l1-8z" />,
                home: <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />,
                layers: <polygon points="12 2 2 7 12 12 22 7 12 2" />,
                sun: <circle cx="12" cy="12" r="5" />,
                moon: <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />,
                'arrow-right': <polyline points="12 5 19 12 12 19" />,
                x: <line x1="18" y1="6" x2="6" y2="18" />,
                message: <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7" />,
                check: <polyline points="20 6 9 17 4 12" />,
                video: <rect x="1" y="5" width="15" height="14" rx="2" />,
                volume: <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" />,
                loader: <circle cx="12" cy="12" r="10" />
            };

            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || <circle cx="12" cy="12" r="10" />}
                </svg>
            );
        };

        const App = () => {
            const [isDarkMode, setIsDarkMode] = useState(false);
            const [currentStep, setCurrentStep] = useState(1);
            const [topic, setTopic] = useState("");
            const [loading, setLoading] = useState(false);
            
            const [isAIVisible, setIsAIVisible] = useState(true);
            const [aiMessage, setAiMessage] = useState("Halo! Studio ACG v6.5 siap membantumu membuat konten viral.");
            const [isThinking, setIsThinking] = useState(false);

            const [contentData, setContentData] = useState({
                titles: [],
                selectedTitle: "",
                script: "",
                generatedImage: null,
                generatedAudio: null,
                isGeneratingVideo: false,
                isGeneratingAudio: false
            });

            useEffect(() => {
                document.body.className = isDarkMode ? 'dark-mode' : 'light-mode';
            }, [isDarkMode]);

            const openaiRequest = async (endpoint, payload, isBlob = false) => {
                const url = `https://api.openai.com/v1/${endpoint}`;
                const retryDelays = [1000, 2000, 4000, 8000, 16000];
                
                for (let i = 0; i <= retryDelays.length; i++) {
                    try {
                        const res = await fetch(url, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                "Authorization": `Bearer ${apiKey}`
                            },
                            body: JSON.stringify(payload)
                        });

                        if (!res.ok) {
                            const errorBody = await res.json().catch(() => ({}));
                            // Check for common error types
                            if (res.status === 401) throw new Error("API Key tidak valid atau belum diatur.");
                            if (res.status === 429) throw new Error("Terlalu banyak permintaan (Rate limit). Silakan tunggu sebentar.");
                            throw new Error(errorBody.error?.message || `Terjadi kesalahan API (Status: ${res.status})`);
                        }

                        return isBlob ? await res.blob() : await res.json();
                    } catch (err) {
                        // If it's a network error (Failed to fetch) or we ran out of retries
                        if (err.name === 'TypeError' && err.message === 'Failed to fetch') {
                            if (i === retryDelays.length) throw new Error("Gagal terhubung ke server OpenAI. Periksa koneksi internet atau API Key Anda.");
                        } else if (i === retryDelays.length) {
                            throw err;
                        }
                        
                        // Exponential backoff
                        await new Promise(r => setTimeout(r, retryDelays[i]));
                    }
                }
            };

            const handleStart = async () => {
                if (!topic.trim()) return;
                setLoading(true);
                setIsThinking(true);
                setAiMessage("Menganalisis tren pasar dengan GPT-4o...");
                
                try {
                    const res = await openaiRequest("chat/completions", {
                        model: "gpt-4o",
                        messages: [
                            { role: "system", content: "Anda adalah ahli viral marketing. Berikan respon dalam format JSON: { \"options\": [ { \"title\": \"Judul\", \"score\": 95 } ] }. Berikan 5 judul dalam Bahasa Indonesia." },
                            { role: "user", content: `Buat judul video viral untuk topik: ${topic}` }
                        ],
                        response_format: { type: "json_object" }
                    });
                    const data = JSON.parse(res.choices[0].message.content);
                    setContentData(prev => ({ ...prev, titles: data.options || [] }));
                    setCurrentStep(2);
                    setAiMessage("Pilih judul yang paling 'nendang' untuk audiensmu!");
                } catch (e) {
                    setAiMessage(`Kesalahan: ${e.message}`);
                    console.error("OpenAI Error:", e);
                } finally {
                    setLoading(false);
                    setIsThinking(false);
                }
            };

            const selectTitle = async (title) => {
                setLoading(true);
                setIsThinking(true);
                setContentData(prev => ({ ...prev, selectedTitle: title }));
                setAiMessage("Menyusun skrip narasi viral...");
                
                try {
                    const res = await openaiRequest("chat/completions", {
                        model: "gpt-4o",
                        messages: [
                            { role: "system", content: "Buat skrip video pendek (30-60 detik) yang menarik. Format JSON: { \"script\": \"Isi skrip...\" }" },
                            { role: "user", content: `Buat skrip untuk judul: ${title}` }
                        ],
                        response_format: { type: "json_object" }
                    });
                    const data = JSON.parse(res.choices[0].message.content);
                    setContentData(prev => ({ ...prev, script: data.script }));
                    setCurrentStep(3);
                    setAiMessage("Skrip sudah siap! Mari tambahkan visual dan audio.");
                } catch (e) {
                    setAiMessage(`Gagal membuat skrip: ${e.message}`);
                } finally {
                    setLoading(false);
                    setIsThinking(false);
                }
            };

            const generateVisual = async () => {
                setContentData(prev => ({ ...prev, isGeneratingVideo: true }));
                setAiMessage("DALL-E 3 sedang melukis visualisasi untukmu...");
                
                try {
                    const res = await openaiRequest("images/generations", {
                        model: "dall-e-3",
                        prompt: `Cinematic high-quality realistic frame for: ${contentData.selectedTitle}. Style: professional production, clear lighting.`,
                        n: 1,
                        size: "1024x1024"
                    });
                    setContentData(prev => ({ ...prev, generatedImage: res.data[0].url }));
                    setAiMessage("Visualisasi berhasil dibuat!");
                } catch (e) {
                    setAiMessage(`Gagal visual: ${e.message}`);
                } finally {
                    setContentData(prev => ({ ...prev, isGeneratingVideo: false }));
                }
            };

            const generateAudio = async () => {
                setContentData(prev => ({ ...prev, isGeneratingAudio: true }));
                setAiMessage("Mengonversi teks menjadi suara AI profesional...");
                
                try {
                    const blob = await openaiRequest("audio/speech", {
                        model: "tts-1",
                        input: contentData.script,
                        voice: "alloy"
                    }, true);
                    const audioUrl = URL.createObjectURL(blob);
                    setContentData(prev => ({ ...prev, generatedAudio: audioUrl }));
                    setAiMessage("Audio narasi siap diputar!");
                } catch (e) {
                    setAiMessage(`Gagal audio: ${e.message}`);
                } finally {
                    setContentData(prev => ({ ...prev, isGeneratingAudio: false }));
                }
            };

            const resetAll = () => {
                setCurrentStep(1);
                setTopic("");
                setContentData({ titles: [], selectedTitle: "", script: "", generatedImage: null, generatedAudio: null, isGeneratingVideo: false, isGeneratingAudio: false });
                setAiMessage("Siap membantu proyek barumu!");
            };

            return (
                <div className="min-h-screen flex flex-col lg:flex-row bg-white dark:bg-[#050505] transition-colors duration-500">
                    {/* Sidebar - Highest Z-index */}
                    <nav className="w-full lg:w-24 border-b lg:border-r border-zinc-200/50 dark:border-zinc-800/50 flex flex-row lg:flex-col items-center justify-between p-4 lg:py-10 bg-white/80 dark:bg-black/80 backdrop-blur-3xl z-[1000] sticky top-0 lg:h-screen">
                        <div onClick={resetAll} className="w-12 h-12 lg:w-14 lg:h-14 btn-openai rounded-[18px] lg:rounded-[22px] flex items-center justify-center text-white shadow-xl cursor-pointer transform active:scale-90 transition-all">
                            <Icon name="zap" size={24} />
                        </div>
                        <div className="flex flex-row lg:flex-col gap-6 lg:gap-8 items-center">
                            <button onClick={resetAll} className="p-2 rounded-xl text-zinc-400 hover:text-[#10a37f] transition-all">
                                <Icon name="home" size={24} />
                            </button>
                            <button onClick={() => setIsDarkMode(!isDarkMode)} className="w-10 h-10 rounded-xl border border-zinc-200 dark:border-zinc-800 flex items-center justify-center text-zinc-500 hover:border-[#10a37f]/50 transition-colors">
                                <Icon name={isDarkMode ? "sun" : "moon"} size={18} />
                            </button>
                        </div>
                    </nav>

                    {/* Main Content Area */}
                    <main className="flex-1 overflow-y-auto p-6 md:p-12 lg:p-16 relative">
                        <div className="max-w-4xl mx-auto pb-20 lg:pb-0">
                            
                            {/* AI Floating Assistant - Dynamic Position */}
                            <div className={`assistant-top-dock transition-all duration-300 ${!isAIVisible ? 'opacity-0 pointer-events-none' : 'opacity-100'}`}>
                                <div className="flex flex-col items-end gap-3">
                                    <div className="flex items-center gap-4">
                                        {isThinking && (
                                            <div className="visualizer bg-white/80 dark:bg-zinc-900/80 px-3 py-1.5 rounded-full backdrop-blur-md border border-[#10a37f]/20">
                                                <div className="bar"></div><div className="bar"></div><div className="bar"></div>
                                            </div>
                                        )}
                                        <div className="ai-orb shadow-2xl"></div>
                                        <button onClick={() => setIsAIVisible(false)} className="w-8 h-8 rounded-full flex items-center justify-center bg-black/5 dark:bg-white/10 text-zinc-500 hover:text-red-500 transition-colors">
                                            <Icon name="x" size={14} />
                                        </button>
                                    </div>
                                    <div className="bg-white/95 dark:bg-zinc-900/90 backdrop-blur-lg p-5 rounded-2xl border border-zinc-200/50 dark:border-zinc-800 shadow-2xl max-w-xs text-right border-r-4 border-r-[#10a37f]">
                                        <p className="text-xs font-semibold text-zinc-700 dark:text-zinc-300 italic leading-relaxed">"{aiMessage}"</p>
                                    </div>
                                </div>
                            </div>

                            <header className="mb-12 mt-4 lg:mt-0">
                                <div className="inline-block px-4 py-1.5 rounded-full bg-[#10a37f]/10 text-[#10a37f] text-[10px] font-bold tracking-[0.2em] uppercase mb-4 border border-[#10a37f]/20">
                                    Studio ACG â€¢ OpenAI Engine
                                </div>
                                <h1 className="text-4xl md:text-6xl lg:text-7xl font-extrabold tracking-tighter text-zinc-900 dark:text-zinc-100 leading-tight">
                                    <span className="shimmer-text">CREATIVE</span> <br/> ENGINE v6.5
                                </h1>
                            </header>

                            {/* Workflow Steps */}
                            <div className="relative z-10">
                                {currentStep === 1 && (
                                    <div className="bento-card p-8 lg:p-10 space-y-8 shadow-2xl animate-in fade-in slide-in-from-bottom-4 duration-700">
                                        <div className="space-y-2">
                                            <label className="text-[10px] font-black uppercase tracking-widest text-zinc-400">Topik Video</label>
                                            <textarea 
                                                value={topic}
                                                onChange={e => setTopic(e.target.value)}
                                                placeholder="Apa yang ingin kamu bahas hari ini?"
                                                className="w-full h-32 lg:h-44 input-glass p-6 text-xl font-semibold outline-none resize-none dark:text-white placeholder:text-zinc-500/30"
                                            />
                                        </div>
                                        <button 
                                            disabled={loading || !topic.trim()}
                                            onClick={handleStart} 
                                            className="w-full py-5 btn-openai text-white font-bold rounded-2xl tracking-widest uppercase shadow-2xl transition-all active:scale-[0.98] disabled:opacity-50"
                                        >
                                            {loading ? 'Analisis GPT...' : 'Mulai Analisis'}
                                        </button>
                                    </div>
                                )}

                                {currentStep === 2 && (
                                    <div className="grid gap-4 animate-in fade-in slide-in-from-right-4 duration-500">
                                        <p className="text-[10px] font-black uppercase tracking-widest text-zinc-400 mb-2">Pilih Hook Viral:</p>
                                        {contentData.titles.map((t, i) => (
                                            <button 
                                                key={i} 
                                                onClick={() => selectTitle(t.title)}
                                                className="w-full bento-card p-6 lg:p-8 flex items-center justify-between group hover:border-[#10a37f]/50 cursor-pointer text-left"
                                            >
                                                <div>
                                                    <p className="text-[10px] font-black uppercase text-[#10a37f] tracking-widest mb-1">Score: {t.score}%</p>
                                                    <p className="font-bold text-xl lg:text-2xl dark:text-zinc-200">{t.title}</p>
                                                </div>
                                                <div className="w-10 h-10 rounded-full bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center group-hover:bg-[#10a37f] group-hover:text-white transition-all ml-4 shrink-0">
                                                    <Icon name="arrow-right" size={18} />
                                                </div>
                                            </button>
                                        ))}
                                    </div>
                                )}

                                {currentStep === 3 && (
                                    <div className="space-y-8 animate-in fade-in zoom-in-95 duration-500">
                                        <div className="bento-card p-8 lg:p-10 shadow-2xl space-y-6">
                                            <h2 className="text-xl font-bold dark:text-white flex items-center gap-2">
                                                <Icon name="message" className="text-[#10a37f]" />
                                                Skrip Narasi
                                            </h2>
                                            <div className="input-glass p-6 min-h-[120px] whitespace-pre-wrap dark:text-zinc-300 italic border-l-4 border-[#10a37f]">
                                                {contentData.script}
                                            </div>
                                            <div className="flex flex-wrap gap-3">
                                                <button onClick={() => navigator.clipboard.writeText(contentData.script)} className="px-6 py-3 bg-zinc-900 dark:bg-zinc-100 text-white dark:text-black font-bold rounded-xl text-[10px] uppercase tracking-widest hover:opacity-90">
                                                    Salin Skrip
                                                </button>
                                                <button onClick={resetAll} className="px-6 py-3 border border-zinc-200 dark:border-zinc-800 rounded-xl font-bold text-[10px] uppercase tracking-widest dark:text-white hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-colors">
                                                    Ulangi
                                                </button>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                            {/* Media Columns */}
                                            <div className="bento-card p-6 space-y-4">
                                                <h3 className="font-bold uppercase tracking-widest text-[10px] dark:text-zinc-400">DALL-E 3 Visual</h3>
                                                <div className="media-preview-box aspect-video">
                                                    {contentData.isGeneratingVideo ? (
                                                        <div className="w-6 h-6 border-2 border-[#10a37f] border-t-transparent rounded-full animate-spin"></div>
                                                    ) : contentData.generatedImage ? (
                                                        <img src={contentData.generatedImage} className="w-full h-full object-cover rounded-xl" />
                                                    ) : (
                                                        <Icon name="video" className="opacity-20" size={32} />
                                                    )}
                                                </div>
                                                <button onClick={generateVisual} disabled={contentData.isGeneratingVideo} className="w-full py-3 bg-[#10a37f]/10 text-[#10a37f] font-bold rounded-xl text-[10px] uppercase tracking-widest hover:bg-[#10a37f] hover:text-white transition-all">
                                                    Generate Image
                                                </button>
                                            </div>

                                            <div className="bento-card p-6 space-y-4">
                                                <h3 className="font-bold uppercase tracking-widest text-[10px] dark:text-zinc-400">OpenAI TTS</h3>
                                                <div className="media-preview-box h-24">
                                                    {contentData.isGeneratingAudio ? (
                                                        <div className="visualizer"><div className="bar"></div><div className="bar"></div><div className="bar"></div></div>
                                                    ) : contentData.generatedAudio ? (
                                                        <audio controls src={contentData.generatedAudio} className="w-full scale-90" />
                                                    ) : (
                                                        <Icon name="volume" className="opacity-20" size={32} />
                                                    )}
                                                </div>
                                                <button onClick={generateAudio} disabled={contentData.isGeneratingAudio} className="w-full py-3 bg-purple-500/10 text-purple-500 font-bold rounded-xl text-[10px] uppercase tracking-widest hover:bg-purple-500 hover:text-white transition-all">
                                                    Generate Voice
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </main>

                    {/* Restore AI Button */}
                    {!isAIVisible && (
                        <button onClick={() => setIsAIVisible(true)} className="fixed bottom-6 right-6 lg:bottom-10 lg:right-10 w-14 h-14 btn-openai rounded-full flex items-center justify-center text-white shadow-2xl z-[500] hover:scale-110 transition-transform">
                            <Icon name="message" size={24} />
                        </button>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
